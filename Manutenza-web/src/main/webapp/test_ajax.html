<!DOCTYPE html>

<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">

        <title>Test Ajax</title>

        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
        <script src="https://www.paypalobjects.com/api/checkout.js"></script>
    </head>
    <body>

        <h1>Test Ajax</h1>

        <button id="testWS">Send Messages</button>
        
        <button id="testMS">Retrieve JSON Messages</button>
        
        <div id="paypal-button"></div>

        <script>
          paypal.Button.render({
            env: 'sandbox', // Or 'sandbox',
            
            client: {
            sandbox:    'AZKbmY1aUYKPgh-f2Ikxc-2wvkee6sBsu7elCAY29ZBCMKasejY3xXX5zbadp4t3YnEXsIaxp1SgIh-D'
            },

            commit: true, // Show a 'Pay Now' button

            style: {
              color: 'gold',
              size: 'small'
            },

            payment: function(data, actions) {
              return actions.payment.create({
                payment: {
                    transactions: [
                        {
                            amount: { total: '1.00', currency: 'USD' }
                        }
                    ]
                }
              });
            },

            onAuthorize: function(data, actions) {
              return actions.payment.execute().then(function(payment) {

                // The payment is complete!
                // You can now show a confirmation message to the customer
              });
            },

            onCancel: function(data, actions) {
              /* 
               * Buyer cancelled the payment 
               */
            },

            onError: function(err) {
              /* 
               * An error occurred during the transaction 
               */
            }
          }, '#paypal-button');
        </script>

        <form action="#" method="POST">
            <input type="hidden" name="scope" value="email" />
            <button type="submit">Facebook</button>
        </form>

        <div id="result"></div>
        
        

        <script type="text/javascript">

            $(document).ready(function () {

                

                /*
                 
                 $('form').submit(function (event) {
                 
                 event.preventDefault();
                 
                 var hiddenInput = $('input[name="scope"]').val();
                 
                 var settings = {
                 "async": true,
                 "crossDomain": true,
                 "url": "http://localhost:8080/connect/facebook",
                 "method": "POST",
                 "headers": {
                 "Content-Type": "application/json",
                 "Cache-Control": "no-cache"
                 },
                 "processData": false,
                 "contentType": false,
                 "mimeType": "multipart/form-data",
                 "data": {'scope': 'email'}
                 }
                 
                 $.ajax(settings).done(function (response) {
                 console.log("pinco");
                 $("#result").html(response);
                 //$('#page').load(response);
                 }).fail(function (jqXHR, textStatus, errorThrown) {
                 console.log(jqXHR.statusCode());
                 console.log(errorThrown);
                 console.log(textStatus);
                 });
                 });
                 
                 */

                //Invio un messaggio al WebService Spring
                $("#testWS").click(function () {
                    
                       $.ajax({
                           //per ex facebook
                            /*url: "http://localhost:8080/connect/facebook",
                            //dataType: 'json',
                            type: 'POST',
                            xhrFields: {
                                withCredentials: true
                            },
                            headers: {
                                'Access-Control-Allow-Headers': 'x-requested-with',
                                'Content-Type':'multipart/form-data'
                            },
                            crossDomain: true,
                            data: {scope:"email"},
                            success: function (data, status) {
                                $("#result").html(data);
                                console.log(status);
                            },
                            error: function(data, status){
                                console.log(status);
                            }*/
            
                            //per JMS
                            "async": true,
                            "crossDomain": true,
                            "url": "http://localhost:8080/sender/sendObjectMessage",
                            "method": "POST",
                            "headers": {
                              "Content-Type": "application/json",
                              "Cache-Control": "no-cache"
                            },
                            "processData": false,
                            "data":  "{\n\t\"mittente\":\"Tizio\",\n\t\"destinatario\":\"Caio\",\n\t\"messaggio\":\"Ciao mondo!\",\n\t\"timestamp\": \"\"\n}",
                            success: function (data, status) {
                                $("#result").html(data);
                                console.log(status);
                            },
                            error: function(data, status){
                                console.log(status);
                            }
                        });
                            
                    
                    /*
                    $.post("http://localhost:8080/ajaxTestPost",
                            {
                                scope: "email"
                            },
                            function (data, status) {
                                //alert("Data: " + data + "\nStatus: " + status);
                                $("#result").html(data);
                                console.log(status);
                            });
                            */
                            
                });
                
                //Prelevo i messaggi dal WebService Spring per quel determinato destinatario
                 $("#testMS").click(function () {
                     var form = new FormData();
                        form.append("mittente", "Tizio");
                        form.append("destinatario", "Caio");

                        var settings = {
                          "async": true,
                          "crossDomain": true,
                          "url": "http://localhost:8080/checkMessage",
                          "method": "POST",
                          "headers": {
                            "Cache-Control": "no-cache"
                          },
                          "processData": false,
                          "contentType": false,
                          "mimeType": "multipart/form-data",
                          "data": form
                        }

                        $.ajax(settings).done(function (response) {
                          console.log(response);
                        });
                 });

            });

        </script>

    </body>
</html>
